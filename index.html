<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Mini Dots</title><meta name="viewport" content="width=device-width,initial-scale=1"><style>body{margin:0;font-family:sans-serif;text-align:center;touch-action:none;user-select:none;background:#fff;padding:1em 1em 2em 1em;box-sizing:border-box}#menu,#game{padding:1em}select,button{font-size:1em;padding:0.3em;margin:0.5em}#scoreDisplay{font-size:1.2em;margin:0.5em auto}#grid-container{padding:2vw;background:#fff;box-sizing:border-box}#grid{--grid-size:8;display:grid;gap:1vw;justify-content:center;margin:0 auto;width:80vw;max-width:80vmin;height:80vw;max-height:80vmin;transition:background 0.2s}.dot{width:100%;aspect-ratio:1/1;border-radius:50%;background:gray;display:flex;align-items:center;justify-content:center;color:#000;font-weight:bold;border:2px solid #fff}.selected{outline:3px solid #000}.combo-flash{background:#fff !important}</style></head><body><div id="menu"><h1>Mini Dots</h1>Grid Size:<select id="gridSize"><option>6</option><option selected>8</option><option>10</option></select>Colors:<select id="colorCount"><option>3</option><option selected>4</option><option>5</option><option>6</option></select>Colorblind:<select id="colorblind"><option value="0" selected>Off</option><option value="1">On</option></select><button id="startBtn">Start</button></div><div id="game" style="display:none;"><div id="scoreDisplay">Score: 0</div><button onclick="location.reload()">Restart</button><button onclick="undo()">Undo</button><div id="grid-container"><div id="grid"></div></div></div><script>const masterColors=["#FF4136","#0074D9","#2ECC40","#FFDC00","#B10DC9","#FF851B"],colorblindMap=["A","B","C","D","E","F"],cbColors=["#E6194B","#3CB44B","#FFE119","#4363D8","#F58231","#911EB4"];let grid=[],selected=[],size=8,colors=[],isDragging=!1,score=0,undoStack=[],comboTriggered=!1,gridEl=document.getElementById("grid"),scoreDisplay=document.getElementById("scoreDisplay"),cbMode=!1;function isAdjacent(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)===1}function isSquareLoop(){if(selected.length!==4)return!1;let xs=selected.map(d=>d.x),ys=selected.map(d=>d.y);let xSet=new Set(xs),ySet=new Set(ys);return xSet.size===2&&ySet.size===2}function startGame(){size=+gridSize.value;let c=+colorCount.value;cbMode=colorblind.value==="1";colors=masterColors.slice(0,c),menu.style.display="none",game.style.display="block",gridEl.style.setProperty("--grid-size",size),gridEl.style.gridTemplateColumns=`repeat(${size},1fr)`,initGrid()}function initGrid(){grid=[],gridEl.innerHTML="";for(let y=0;y<size;y++){grid[y]=[];for(let x=0;x<size;x++){let i=Math.floor(Math.random()*colors.length),col=colors[i];grid[y][x]=col;let d=document.createElement("div");d.className="dot",d.style.background=cbMode?cbColors[i]:col,d.dataset.x=x,d.dataset.y=y;if(cbMode)d.textContent=colorblindMap[i];d.addEventListener("mousedown",startDrag),d.addEventListener("touchstart",startDrag,{passive:!1}),d.addEventListener("mouseenter",dragOver),d.addEventListener("touchmove",dragMove,{passive:!1}),gridEl.appendChild(d)}}document.addEventListener("mouseup",endDrag),document.addEventListener("touchend",endDrag)}function startDrag(e){e.preventDefault(),isDragging=!0,comboTriggered=!1;let t=e.target,x=+t.dataset.x,y=+t.dataset.y;selected=[{x,y}],t.classList.add("selected")}function dragOver(e){if(!isDragging||comboTriggered)return;let t=e.target;if(!t.classList.contains("dot"))return;let x=+t.dataset.x,y=+t.dataset.y,last=selected[selected.length-1];if(x===last.x&&y===last.y)return;let idx=selected.findIndex(s=>s.x===x&&s.y===y);if(selected.length>1&&idx===selected.length-2){let removed=selected.pop(),i=removed.y*size+removed.x;gridEl.children[i].classList.remove("selected");return}if(grid[y][x]!==grid[last.y][last.x]||!isAdjacent({x,y},last))return;if(idx!==-1){selected.push({x,y});comboTriggered=!0;return}selected.push({x,y}),t.classList.add("selected")}function dragMove(e){e.preventDefault();let t=e.touches[0],el=document.elementFromPoint(t.clientX,t.clientY);dragOver({target:el})}function endDrag(){if(!isDragging)return;isDragging=!1;let last=selected[selected.length-1];let idx=selected.slice(0,-1).findIndex(p=>p.x===last.x&&p.y===last.y);if(comboTriggered&&idx!==-1){saveState();removeDots(grid[last.y][last.x],!0),flashGrid()}else if(selected.length===4&&isSquareLoop()){saveState();removeDots(grid[selected[0].y][selected[0].x],!0),flashGrid()}else if(selected.length>=2){saveState();removeDots(grid[selected[0].y][selected[0].x])}else clearSelection()}function removeDots(color,all=!1){let toRemove=all?getAll(color):[...selected];selected=[],score+=toRemove.length,scoreDisplay.textContent="Score: "+score,toRemove.forEach(({x,y})=>{grid[y][x]=null;let i=y*size+x;gridEl.children[i].style.background="transparent",gridEl.children[i].textContent="",gridEl.children[i].classList.remove("selected")}),setTimeout(dropAndRefill,300)}function getAll(c){let o=[];for(let y=0;y<size;y++)for(let x=0;x<size;x++)grid[y][x]===c&&o.push({x,y});return o}function dropAndRefill(){for(let x=0;x<size;x++){let col=[];for(let y=0;y<size;y++)grid[y][x]&&col.push(grid[y][x]);while(col.length<size)col.unshift(colors[Math.floor(Math.random()*colors.length)]);for(let y=0;y<size;y++)grid[y][x]=col[y]}render()}function render(){for(let y=0;y<size;y++)for(let x=0;x<size;x++){let i=y*size+x,c=grid[y][x],ci=colors.indexOf(c);gridEl.children[i].style.background=cbMode?cbColors[ci]:c,gridEl.children[i].textContent=cbMode?colorblindMap[ci]:""}}function clearSelection(){selected.forEach(({x,y})=>{let i=y*size+x;gridEl.children[i].classList.remove("selected")}),selected=[]}function flashGrid(){gridEl.classList.add("combo-flash"),setTimeout(()=>gridEl.classList.remove("combo-flash"),150)}function saveState(){undoStack.push({grid:JSON.parse(JSON.stringify(grid)),score}),undoStack.length>20&&undoStack.shift()}function undo(){if(!undoStack.length)return;let last=undoStack.pop();grid=JSON.parse(JSON.stringify(last.grid)),score=last.score,scoreDisplay.textContent="Score: "+score,render()}document.getElementById("startBtn").addEventListener("click",startGame);document.body.addEventListener("touchmove",e=>{e.target.classList.contains("dot")&&e.preventDefault()},{passive:!1});const gridSize=document.getElementById("gridSize"),colorCount=document.getElementById("colorCount"),colorblind=document.getElementById("colorblind"),menu=document.getElementById("menu"),game=document.getElementById("game");</script></body></html>
