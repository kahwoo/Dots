<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>BubbleWhack</title>
<style>
  body{margin:0;background:#222;color:#fff;font-family:sans-serif;overflow:hidden;}
  #hud{position:fixed;top:10px;left:10px;z-index:10;background:rgba(0,0,0,0.4);
       padding:8px 12px;border-radius:8px;font-size:16px;user-select:none;}
  #hud div{margin:4px 0;}
  canvas{display:block;}
</style>
</head>
<body>
<div id="hud">
  <div>Score: <span id="score">0</span></div>
  <div>Level: <span id="level">1</span></div>
  <div>Time: <span id="time">60</span>s</div>
  <button id="startBtn">Start</button>
</div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const timeEl  = document.getElementById('time');
const startBtn = document.getElementById('startBtn');

let bubbles = [];
let running=false;
let score=0;
let level=1;
let timeLeft=60;
let spawnRate=1000; // ms
let lastSpawn=0;
let lastTime=0;
let audioCtx;

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize',resize);
resize();

function playPop(){
  if(!audioCtx) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type='sine';
  o.frequency.value = 300+Math.random()*600;
  o.connect(g);
  g.connect(audioCtx.destination);
  g.gain.setValueAtTime(0.2,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.2);
  o.start();
  o.stop(audioCtx.currentTime+0.2);
}

function spawnBubble(){
  const r = 20+Math.random()*40;
  bubbles.push({
    x: r + Math.random()*(canvas.width - 2*r),
    y: canvas.height + r,
    r: r,
    speed: 50 + Math.random()*50,
    color: `hsl(${Math.random()*360},70%,60%)`
  });
}

function update(dt){
  bubbles.forEach(b=>b.y -= b.speed*dt);
  bubbles = bubbles.filter(b=>b.y + b.r > 0);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  bubbles.forEach(b=>{
    ctx.beginPath();
    ctx.fillStyle=b.color;
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });
}

function gameLoop(ts){
  if(!running) return;
  const dt = (ts - lastTime)/1000;
  lastTime = ts;
  if(ts - lastSpawn > spawnRate){
    spawnBubble();
    lastSpawn = ts;
  }
  update(dt);
  draw();
  timeLeft -= dt;
  if(timeLeft <=0){
    running=false;
    startBtn.textContent='Restart';
    return;
  }
  timeEl.textContent = timeLeft.toFixed(0);
  requestAnimationFrame(gameLoop);
}

canvas.addEventListener('click',e=>{
  if(!running) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  for(let i=bubbles.length-1;i>=0;i--){
    const b=bubbles[i];
    if((x-b.x)**2 + (y-b.y)**2 < b.r**2){
      bubbles.splice(i,1);
      score += 10;
      scoreEl.textContent = score;
      playPop();
      break;
    }
  }
});

startBtn.addEventListener('click',()=>{
  audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
  score=0; level=1; timeLeft=60;
  scoreEl.textContent=score;
  levelEl.textContent=level;
  timeEl.textContent=timeLeft;
  bubbles=[];
  running=true;
  lastTime=performance.now();
  lastSpawn=lastTime;
  requestAnimationFrame(gameLoop);
});
</script>
</body>
</html>